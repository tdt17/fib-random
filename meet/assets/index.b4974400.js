import{r as z,w as k,i as G,d as Q,c as x,H as Y,a as I,j as B,z as Z,n as W,b as g,o as i,e as d,f as S,v as E,u as c,g as p,t as y,F as f,h as $,k as C,l as M,m as w,p as D,q as F,s as X,x as L,y as j,A as R,B as T,C as ee,D as te}from"./vendor.35ae4d02.js";const se=function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))a(s);new MutationObserver(s=>{for(const n of s)if(n.type==="childList")for(const o of n.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&a(o)}).observe(document,{childList:!0,subtree:!0});function r(s){const n={};return s.integrity&&(n.integrity=s.integrity),s.referrerpolicy&&(n.referrerPolicy=s.referrerpolicy),s.crossorigin==="use-credentials"?n.credentials="include":s.crossorigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function a(s){if(s.ep)return;s.ep=!0;const n=r(s);fetch(s.href,n)}};se();const V="fib-config",v=z({name:""});Object.assign(v,JSON.parse(localStorage.getItem(V)||"{}"));k(v,t=>{localStorage.setItem(V,JSON.stringify(t))});G({apiKey:"AIzaSyDlAUfPJ6T-xQMJcsbAT3SW7zFSFxDQZh4",authDomain:"fib-random.firebaseapp.com",projectId:"fib-random",storageBucket:"fib-random.appspot.com",messagingSenderId:"724579742971",appId:"1:724579742971:web:7b8e2259a4d585b9be6c5e"});const N=Q(),ne=async()=>{const t={users:{},settings:{admin:v.name,options:["1","2","3","5","8","13","21"],openSettings:!1}};return(await Z(W(N,"sessions"),t)).id},l=z({loading:!0,id:window.location.hash.slice(1),active:!1,state:void 0}),ae=x(()=>{var t,e;return Object.keys((e=(t=l.state)==null?void 0:t.users)!=null?e:{}).sort()}),U=x(()=>{var t,e;return Object.values((e=(t=l.state)==null?void 0:t.users)!=null?e:{}).every(({ready:r})=>r)});let O;k(()=>[l.id,v.name],([t,e])=>{if(!e||!t){l.loading=!1;return}O==null||O(),O=Y(I(N,`sessions/${t}`),r=>{l.active=r.exists(),l.state=r.data(),l.loading=!1})},{immediate:!0});const J=async(t,e)=>{await B(I(N,`sessions/${l.id}`),{users:{[t]:e}},{merge:!0})},oe=async t=>{await B(I(N,`sessions/${l.id}`),{settings:t},{merge:!0})};k(()=>{var t;return[(t=l.state)==null?void 0:t.users,v.name]},([t,e])=>{!t||typeof t=="string"||!e||typeof e!="string"||t[e]||J(e,{ready:!1,estimate:""+~~(Math.random()*100)})});window.addEventListener("hashchange",()=>{l.id=window.location.hash.slice(1)});Object.assign(window,{session:l});const le=g({setup(t){const e=async()=>{const r=await ne();window.location.hash=r};return(r,a)=>(i(),d(f,null,[S(p("div",null,'Session "'+y(c(l).id)+'" not found',513),[[E,c(l).id]]),p("button",{onClick:e},"New Session")],64))}});const q=g({props:{roll:{type:Boolean},value:null,values:null,scale:{default:.2},speed:{default:1}},setup(t){const e=t,r=x(()=>e.roll?new Array(20).fill("?"):new Array(20).fill(e.value)),a=$([0,0,0]);let s;const n=()=>{const o=setInterval(()=>{const[u,_,m]=a.value,h=e.speed*300,b=[Math.random(),Math.random(),Math.random()],A=b[0]+b[1]+b[2],[H,K,P]=[h*b[0]/A,h*b[1]/A,h*b[2]/A];a.value=[u+H,_+K,m+P]},1e3);s=()=>clearInterval(o)};return k(()=>e.roll,o=>{o?n():(s==null||s(),a.value=[231,107,0])},{immediate:!0}),(o,u)=>(i(),d("div",{class:"dice-box",style:M({width:400*e.scale+"px",height:400*e.scale+"px"})},[p("ul",{class:"d20",style:M({transform:`scale3d(${e.scale},${e.scale},${e.scale}) rotateX(${a.value[0]}deg) rotateY(${a.value[1]}deg) rotateZ(${a.value[2]}deg)`,transition:`1s ${e.roll?"linear":"ease-out"}`})},[(i(!0),d(f,null,C(c(r),_=>(i(),d("li",null,y(_),1))),256))],4)],4))}});const re=g({props:{name:null,user:null},setup(t){return(e,r)=>(i(),d("div",{class:D(["user",{active:t.name===c(v).name}])},[p("h3",null,y(t.name)+" "+y(t.user.ready?"\u2714":"\u25FB\uFE0E"),1),w(q,{roll:!t.user.ready,value:c(U)?t.user.estimate||"":"?",values:[]},null,8,["roll","value"])],2))}});const ie={key:1,class:"settings"},ue=p("h3",null,"Settings",-1),ce=j(" Settings for all available: "),de=p("br",null,null,-1),_e=j(" Options: "),pe=p("br",null,null,-1),ve=g({setup(t){var n;const e=$(!1),r=()=>{e.value=!e.value},a=$((n=l.state)==null?void 0:n.settings.options.join(";"));k(()=>{var o;return(o=l.state)==null?void 0:o.settings.options.join(";")},o=>{a.value=o});const s=()=>{var o,u,_;oe({options:(u=(o=a.value)==null?void 0:o.split(";"))!=null?u:[],openSettings:(_=l.state)==null?void 0:_.settings.openSettings})};return(o,u)=>{var _;return i(),d(f,null,[((_=c(l).state)==null?void 0:_.settings.admin)===c(v).name?(i(),d("button",{key:0,class:"settings-toggle",onClick:r},"\u2699\uFE0F")):F("",!0),e.value?(i(),d("div",ie,[ue,ce,S(p("input",{type:"checkbox","onUpdate:modelValue":u[0]||(u[0]=m=>c(l).state.settings.openSettings=m)},null,512),[[X,c(l).state.settings.openSettings]]),de,_e,S(p("input",{"onUpdate:modelValue":u[1]||(u[1]=m=>a.value=m)},null,512),[[L,a.value]]),pe,p("button",{onClick:s},"save")])):F("",!0)],64)}}});const me=["onClick"],fe=g({setup(t){const e=x(()=>{var n;return(n=l.state)==null?void 0:n.users[v.name]}),r=(n,o)=>{var m,h;const u=((m=e.value)==null?void 0:m.estimate)===n,_=o!=null?o:u?!((h=e.value)!=null&&h.ready):!0;J(v.name,{ready:_,estimate:_?n:R()})},a=$("");let s;return document.addEventListener("keydown",n=>{if(["Backspace"].includes(n.key)){clearTimeout(s),a.value="",r(null,!1);return}a.value+=n.key,clearTimeout(s),s=setTimeout(()=>{var o;(o=l.state)!=null&&o.settings.options.includes(a.value)&&r(a.value,!0),a.value=""},500)}),(n,o)=>{var u;return i(),d(f,null,[p("div",null,y(a.value),1),(i(!0),d(f,null,C((u=c(l).state)==null?void 0:u.settings.options,_=>{var m;return i(),d("button",{class:D({active:_===((m=c(e))==null?void 0:m.estimate)}),onClick:h=>r(_)},y(_),11,me)}),256))],64)}}});const ge={key:0,class:"results"},ye=p("h3",null,"Result:",-1),he={class:"entry"},be=g({setup(t){const e=x(()=>{var a,s;return Object.values((s=(a=l.state)==null?void 0:a.users)!=null?s:{}).reduce((n,{estimate:o=""})=>{var u;return n[o]=((u=n[o])!=null?u:0)+1,n},{})});return(r,a)=>c(U)?(i(),d("div",ge,[ye,S(w(q,{roll:!1,value:Math.max(...Object.keys(c(e)))+"",values:[]},null,8,["value"]),[[E,Object.keys(c(e)).length<=2]]),p("div",null,[(i(!0),d(f,null,C(c(e),(s,n)=>(i(),d("span",he,y(s)+"x "+y(n),1))),256))])])):F("",!0)}});const xe={class:"users"},we=g({setup(t){return(e,r)=>(i(),d(f,null,[w(ve),w(fe),p("div",xe,[(i(!0),d(f,null,C(c(ae),a=>{var s;return i(),T(re,{name:a,user:(s=c(l).state)==null?void 0:s.users[a]},null,8,["name","user"])}),256))]),w(be)],64))}}),Se=j(" Enter your name: "),$e=j(),ke=g({setup(t){const e=$(v.name),r=()=>{v.name=e.value};return(a,s)=>(i(),d(f,null,[Se,S(p("input",{"onUpdate:modelValue":s[0]||(s[0]=n=>e.value=n)},null,512),[[L,e.value]]),$e,p("button",{onClick:r},"Go")],64))}});const Oe=g({setup(t){const e=x(()=>v.name?l.loading?null:l.active?we:le:ke);return(r,a)=>(i(),T(ee(c(e))))}});te(Oe).mount("#app");
