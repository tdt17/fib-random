import{r as Y,w as $,a as O,i as ae,d as oe,c as b,H as le,b as H,j as Q,z as re,n as ie,e as w,o as u,f as _,g as k,v as A,u as r,h as c,t as y,F as h,k as V,l as q,m as E,p as M,q as T,T as Z,s as B,x as F,y as ue,A as j,B as J,C as ce,D as de,E as ve}from"./vendor.bf682403.js";const _e=function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))n(s);new MutationObserver(s=>{for(const l of s)if(l.type==="childList")for(const a of l.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&n(a)}).observe(document,{childList:!0,subtree:!0});function o(s){const l={};return s.integrity&&(l.integrity=s.integrity),s.referrerpolicy&&(l.referrerPolicy=s.referrerpolicy),s.crossorigin==="use-credentials"?l.credentials="include":s.crossorigin==="anonymous"?l.credentials="omit":l.credentials="same-origin",l}function n(s){if(s.ep)return;s.ep=!0;const l=o(s);fetch(s.href,l)}};_e();const R="fib-config",m=Y({name:""});Object.assign(m,JSON.parse(localStorage.getItem(R)||"{}"));$(m,e=>{localStorage.setItem(R,JSON.stringify(e))});const C=O(!1);ae({apiKey:"AIzaSyDlAUfPJ6T-xQMJcsbAT3SW7zFSFxDQZh4",authDomain:"fib-random.firebaseapp.com",projectId:"fib-random",storageBucket:"fib-random.appspot.com",messagingSenderId:"724579742971",appId:"1:724579742971:web:7b8e2259a4d585b9be6c5e"});const U=oe(),me=async()=>{const e={users:{},settings:{admin:m.name,options:["1","2","3","5","8","13","21"],openSettings:!1}};return(await re(ie(U,"sessions"),e)).id},i=Y({loading:!0,id:window.location.hash.slice(1),active:!1,state:void 0}),z=b(()=>{var e;return Object.fromEntries(Object.entries(((e=i.state)==null?void 0:e.users)||{}).filter(([,{viewOnly:t}])=>!t))}),pe=b(()=>{var e;return Object.fromEntries(Object.entries(((e=i.state)==null?void 0:e.users)||{}).filter(([,{viewOnly:t}])=>t))}),fe=b(()=>Object.keys(z.value).sort()),G=b(()=>Object.keys(pe.value).sort()),W=b(()=>Object.values(z.value).every(({ready:e})=>e)),x=b(()=>{var e;return(e=i.state)==null?void 0:e.users[m.name]}),D=b(()=>{var e,t;return((e=i.state)==null?void 0:e.settings.openSettings)||((t=i.state)==null?void 0:t.settings.admin)===m.name});let I;$(()=>[i.id,m.name],([e,t])=>{if(!t||!e){i.loading=!1;return}I==null||I(),I=le(H(U,`sessions/${e}`),o=>{i.active=o.exists(),i.state=o.data(),i.loading=!1})},{immediate:!0});const L=async(e,t)=>{await Q(H(U,`sessions/${i.id}`),{users:{[e]:t}},{merge:!0})},X=async e=>{await Q(H(U,`sessions/${i.id}`),e,{merge:!0})};$(()=>{var e;return[(e=i.state)==null?void 0:e.users,m.name]},([e,t])=>{!e||typeof e=="string"||!t||typeof t!="string"||e[t]||L(t,{ready:!1,estimate:""+~~(Math.random()*100)})});window.addEventListener("hashchange",()=>{i.id=window.location.hash.slice(1)});Object.assign(window,{session:i});const ge=w({setup(e){const t=async()=>{const o=await me();window.location.hash=o};return(o,n)=>(u(),_(h,null,[k(c("div",null,'Session "'+y(r(i).id)+'" not found',513),[[A,r(i).id]]),c("button",{onClick:t},"New Session")],64))}});const ee=w({props:{roll:{type:Boolean},value:null,values:null,scale:{default:.2},speed:{default:1}},setup(e){const t=e,o=b(()=>t.roll?new Array(20).fill("?"):new Array(20).fill(t.value)),n=O([0,0,0]);let s;const l=()=>{const a=setInterval(()=>{const[g,v,p]=n.value,d=t.speed*300,f=[Math.random(),Math.random(),Math.random()],S=f[0]+f[1]+f[2],[P,se,ne]=[d*f[0]/S,d*f[1]/S,d*f[2]/S];n.value=[g+P,v+se,p+ne]},1e3);s=()=>clearInterval(a)};return $(()=>t.roll,a=>{a?l():(s==null||s(),n.value=[231,107,0])},{immediate:!0}),(a,g)=>(u(),_("div",{class:"dice-box",style:q({width:400*t.scale+"px",height:400*t.scale+"px"})},[c("ul",{class:"d20",style:q({transform:`scale3d(${t.scale},${t.scale},${t.scale}) rotateX(${n.value[0]}deg) rotateY(${n.value[1]}deg) rotateZ(${n.value[2]}deg)`,transition:`1s ${t.roll?"linear":"ease-out"}`})},[(u(!0),_(h,null,V(r(o),v=>(u(),_("li",null,y(v),1))),256))],4)],4))}});const ye={class:"configs"},he=w({props:{name:null,user:null},setup(e){const t=e,o=()=>{L(t.name,{viewOnly:!0})};return(n,s)=>(u(),_("div",{class:M(["user",{active:e.name===r(m).name,"view-mode":e.user.viewOnly}])},[k(c("div",ye,[c("button",{onClick:o},"\u{1F441}")],512),[[A,r(C)]]),c("h3",null,y(e.name)+" "+y(e.user.ready?"\u2714":"\u25FB\uFE0E"),1),E(ee,{roll:!e.user.ready,value:r(W)?e.user.estimate||"":"?",values:[]},null,8,["roll","value"])],2))}});const be={key:0,class:"settings"},ke=c("h3",null,"Settings",-1),we=j("Name: "),Oe={key:0},xe=j("Options: "),Se={key:1},$e=j("Settings for all available: "),je=w({setup(e){var a,g;const t=()=>{C.value=!C.value},o=O((a=i.state)==null?void 0:a.settings.options.join(";"));$(()=>{var v;return(v=i.state)==null?void 0:v.settings.options.join(";")},v=>{o.value=v});const n=O(m.name),s=O((g=i.state)==null?void 0:g.settings.openSettings),l=()=>{var p,d,f;const v={};if(n.value!==m.name){if((p=i.state)!=null&&p.users[n.value]){alert(`Name "${n.value}" is already taken`),n.value=m.name;return}v.users={[m.name]:J()},m.name=n.value}D.value&&(v.settings={options:(f=(d=o.value)==null?void 0:d.split(";"))!=null?f:[],openSettings:s.value}),X(v)};return(v,p)=>(u(),_(h,null,[(u(),T(Z,{to:"#globalcontrols"},[c("button",{class:M({active:r(C)}),onClick:t},"\u2699\uFE0F",2)])),r(C)?(u(),_("div",be,[ke,c("div",null,[we,k(c("input",{"onUpdate:modelValue":p[0]||(p[0]=d=>n.value=d)},null,512),[[B,n.value]])]),r(D)?(u(),_("div",Oe,[xe,k(c("input",{"onUpdate:modelValue":p[1]||(p[1]=d=>o.value=d)},null,512),[[B,o.value]])])):F("",!0),r(D)?(u(),_("div",Se,[$e,k(c("input",{type:"checkbox","onUpdate:modelValue":p[2]||(p[2]=d=>s.value=d)},null,512),[[ue,s.value]])])):F("",!0),c("button",{onClick:l},"save")])):F("",!0)],64))}}),te="theme",N=O(!1),K=e=>{localStorage.setItem(te,e),N.value=e==="dark",document.body.className=`theme-${e}`},Ce=()=>{const e=window.matchMedia("(prefers-color-scheme: dark)").matches,t=localStorage.getItem(te);K(t||(e?"dark":"light"))};$(N,e=>{K(e?"dark":"light")});const Ee={class:"viewer"},Me=j(" Viewer: "),Fe=["onClick"],Ne=w({setup(e){const t=()=>{var a;L(m.name,{viewOnly:!((a=x.value)!=null&&a.viewOnly)})},o=(a,g)=>{var d,f;const v=((d=x.value)==null?void 0:d.estimate)===a,p=g!=null?g:v?!((f=x.value)!=null&&f.ready):!0;L(m.name,{ready:p,estimate:p?a:J()})},n=O("");let s;document.addEventListener("keydown",a=>{var g;if(!((g=x.value)!=null&&g.viewOnly)){if(["Backspace"].includes(a.key)){clearTimeout(s),n.value="",o(null,!1);return}a.key.length>1||(n.value+=a.key,clearTimeout(s),s=setTimeout(()=>{var v;(v=i.state)!=null&&v.settings.options.includes(n.value)&&o(n.value,!0),n.value=""},500))}});const l=()=>{N.value=!N.value};return(a,g)=>{var v,p;return u(),_(h,null,[(u(),T(Z,{to:"#globalcontrols"},[c("button",{onClick:l,title:"Darkmode"},y(r(N)?"\u2600\uFE0F":"\u{1F319}"),1),c("button",{onClick:t,class:M({active:(v=r(x))==null?void 0:v.viewOnly}),title:"View Mode"},"\u{1F441}",2),k(c("div",Ee,[Me,(u(!0),_(h,null,V(r(G),d=>(u(),_("span",{class:M({active:d===r(m).name})},y(d),3))),256))],512),[[A,r(G).length>0]])])),c("div",null,y(n.value),1),(u(!0),_(h,null,V((p=r(i).state)==null?void 0:p.settings.options,d=>{var f,S;return k((u(),_("button",{class:M({active:d===((f=r(x))==null?void 0:f.estimate)}),onClick:P=>o(d)},y(d),11,Fe)),[[A,!((S=r(x))!=null&&S.viewOnly)]])}),256))],64)}}});const Ae={key:0,class:"results"},Ve=c("h3",null,"Result:",-1),Ie={class:"entry"},De=w({setup(e){const t=b(()=>Object.values(z.value).reduce((s,{estimate:l=""})=>{var a;return s[l]=((a=s[l])!=null?a:0)+1,s},{})),o=()=>{var s;const n=Object.fromEntries(Object.keys(((s=i.state)==null?void 0:s.users)||{}).map(l=>[l,{ready:!1,estimate:J()}]));X({users:n})};return(n,s)=>r(W)?(u(),_("div",Ae,[Ve,k(E(ee,{roll:!1,value:Math.max(...Object.keys(r(t)))+"",values:[]},null,8,["value"]),[[A,Object.keys(r(t)).length<=2]]),c("div",null,[(u(!0),_(h,null,V(r(t),(l,a)=>(u(),_("span",Ie,y(l)+"x "+y(a),1))),256))]),r(D)?(u(),_("button",{key:0,onClick:o},"Next")):F("",!0)])):F("",!0)}});const Le=c("div",{id:"globalcontrols"},null,-1),Te={class:"users"},Ue=w({setup(e){return(t,o)=>(u(),_(h,null,[Le,E(je),E(Ne),c("div",Te,[(u(!0),_(h,null,V(r(fe),n=>(u(),T(he,{name:n,user:r(z)[n]},null,8,["name","user"]))),256))]),E(De)],64))}}),ze=j(" Enter your name: "),Be=j(),Ke=w({setup(e){const t=O(m.name),o=()=>{m.name=t.value},n=s=>{s.key==="Enter"&&o()};return(s,l)=>(u(),_(h,null,[ze,k(c("input",{"onUpdate:modelValue":l[0]||(l[0]=a=>t.value=a),onKeypress:n},null,544),[[B,t.value]]),Be,c("button",{onClick:o},"Go")],64))}});const He=w({setup(e){ce(Ce);const t=b(()=>m.name?i.loading?null:i.active?Ue:ge:Ke);return(o,n)=>(u(),T(de(r(t))))}});ve(He).mount("#app");
