import{r as H,w as A,a as $,i as ee,d as te,c as h,H as se,b as L,j as K,z as ne,n as ae,e as x,o as r,f as d,g as w,v as N,u as i,h as u,t as b,F as y,k as V,l as J,m as j,p as C,q as I,T as P,s as D,x as E,y as le,A as k,B as G,C as oe,D as ie}from"./vendor.2e9455bf.js";const re=function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))n(s);new MutationObserver(s=>{for(const a of s)if(a.type==="childList")for(const v of a.addedNodes)v.tagName==="LINK"&&v.rel==="modulepreload"&&n(v)}).observe(document,{childList:!0,subtree:!0});function l(s){const a={};return s.integrity&&(a.integrity=s.integrity),s.referrerpolicy&&(a.referrerPolicy=s.referrerpolicy),s.crossorigin==="use-credentials"?a.credentials="include":s.crossorigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function n(s){if(s.ep)return;s.ep=!0;const a=l(s);fetch(s.href,a)}};re();const Q="fib-config",m=H({name:""});Object.assign(m,JSON.parse(localStorage.getItem(Q)||"{}"));A(m,t=>{localStorage.setItem(Q,JSON.stringify(t))});const S=$(!1);ee({apiKey:"AIzaSyDlAUfPJ6T-xQMJcsbAT3SW7zFSFxDQZh4",authDomain:"fib-random.firebaseapp.com",projectId:"fib-random",storageBucket:"fib-random.appspot.com",messagingSenderId:"724579742971",appId:"1:724579742971:web:7b8e2259a4d585b9be6c5e"});const T=te(),ue=async()=>{const t={users:{},settings:{admin:m.name,options:["1","2","3","5","8","13","21"],openSettings:!1}};return(await ne(ae(T,"sessions"),t)).id},o=H({loading:!0,id:window.location.hash.slice(1),active:!1,state:void 0}),z=h(()=>{var t;return Object.fromEntries(Object.entries(((t=o.state)==null?void 0:t.users)||{}).filter(([,{viewOnly:e}])=>!e))}),ce=h(()=>{var t;return Object.fromEntries(Object.entries(((t=o.state)==null?void 0:t.users)||{}).filter(([,{viewOnly:e}])=>e))}),de=h(()=>Object.keys(z.value).sort()),q=h(()=>Object.keys(ce.value).sort()),Y=h(()=>Object.values(z.value).every(({ready:t})=>t)),O=h(()=>{var t;return(t=o.state)==null?void 0:t.users[m.name]}),B=h(()=>{var t,e;return((t=o.state)==null?void 0:t.settings.openSettings)||((e=o.state)==null?void 0:e.settings.admin)===m.name});let M;A(()=>[o.id,m.name],([t,e])=>{if(!e||!t){o.loading=!1;return}M==null||M(),M=se(L(T,`sessions/${t}`),l=>{o.active=l.exists(),o.state=l.data(),o.loading=!1})},{immediate:!0});const U=async(t,e)=>{await K(L(T,`sessions/${o.id}`),{users:{[t]:e}},{merge:!0})},ve=async t=>{await K(L(T,`sessions/${o.id}`),t,{merge:!0})};A(()=>{var t;return[(t=o.state)==null?void 0:t.users,m.name]},([t,e])=>{!t||typeof t=="string"||!e||typeof e!="string"||t[e]||U(e,{ready:!1,estimate:""+~~(Math.random()*100)})});window.addEventListener("hashchange",()=>{o.id=window.location.hash.slice(1)});Object.assign(window,{session:o});const _e=x({setup(t){const e=async()=>{const l=await ue();window.location.hash=l};return(l,n)=>(r(),d(y,null,[w(u("div",null,'Session "'+b(i(o).id)+'" not found',513),[[N,i(o).id]]),u("button",{onClick:e},"New Session")],64))}});const Z=x({props:{roll:{type:Boolean},value:null,values:null,scale:{default:.2},speed:{default:1}},setup(t){const e=t,l=h(()=>e.roll?new Array(20).fill("?"):new Array(20).fill(e.value)),n=$([0,0,0]);let s;const a=()=>{const v=setInterval(()=>{const[f,_,c]=n.value,p=e.speed*300,g=[Math.random(),Math.random(),Math.random()],F=g[0]+g[1]+g[2],[W,X,R]=[p*g[0]/F,p*g[1]/F,p*g[2]/F];n.value=[f+W,_+X,c+R]},1e3);s=()=>clearInterval(v)};return A(()=>e.roll,v=>{v?a():(s==null||s(),n.value=[231,107,0])},{immediate:!0}),(v,f)=>(r(),d("div",{class:"dice-box",style:J({width:400*e.scale+"px",height:400*e.scale+"px"})},[u("ul",{class:"d20",style:J({transform:`scale3d(${e.scale},${e.scale},${e.scale}) rotateX(${n.value[0]}deg) rotateY(${n.value[1]}deg) rotateZ(${n.value[2]}deg)`,transition:`1s ${e.roll?"linear":"ease-out"}`})},[(r(!0),d(y,null,V(i(l),_=>(r(),d("li",null,b(_),1))),256))],4)],4))}});const me={class:"configs"},pe=x({props:{name:null,user:null},setup(t){const e=t,l=()=>{U(e.name,{viewOnly:!0})};return(n,s)=>(r(),d("div",{class:C(["user",{active:t.name===i(m).name,"view-mode":t.user.viewOnly}])},[w(u("div",me,[u("button",{onClick:l},"\u{1F441}")],512),[[N,i(S)]]),u("h3",null,b(t.name)+" "+b(t.user.ready?"\u2714":"\u25FB\uFE0E"),1),j(Z,{roll:!t.user.ready,value:i(Y)?t.user.estimate||"":"?",values:[]},null,8,["roll","value"])],2))}});const fe={key:0,class:"settings"},ge=u("h3",null,"Settings",-1),ye=k("Name: "),he={key:0},we=k("Options: "),be={key:1},xe=k("Settings for all available: "),Oe=x({setup(t){var v,f;const e=()=>{S.value=!S.value},l=$((v=o.state)==null?void 0:v.settings.options.join(";"));A(()=>{var _;return(_=o.state)==null?void 0:_.settings.options.join(";")},_=>{l.value=_});const n=$(m.name),s=$((f=o.state)==null?void 0:f.settings.openSettings),a=()=>{var c,p,g;const _={};if(n.value!==m.name){if((c=o.state)!=null&&c.users[n.value]){alert(`Name "${n.value}" is already taken`),n.value=m.name;return}_.users={[m.name]:G()},m.name=n.value}B.value&&(_.settings={options:(g=(p=l.value)==null?void 0:p.split(";"))!=null?g:[],openSettings:s.value}),ve(_)};return(_,c)=>(r(),d(y,null,[(r(),I(P,{to:"#globalcontrols"},[u("button",{class:C({active:i(S)}),onClick:e},"\u2699\uFE0F",2)])),i(S)?(r(),d("div",fe,[ge,u("div",null,[ye,w(u("input",{"onUpdate:modelValue":c[0]||(c[0]=p=>n.value=p)},null,512),[[D,n.value]])]),i(B)?(r(),d("div",he,[we,w(u("input",{"onUpdate:modelValue":c[1]||(c[1]=p=>l.value=p)},null,512),[[D,l.value]])])):E("",!0),i(B)?(r(),d("div",be,[xe,w(u("input",{type:"checkbox","onUpdate:modelValue":c[2]||(c[2]=p=>s.value=p)},null,512),[[le,s.value]])])):E("",!0),u("button",{onClick:a},"save")])):E("",!0)],64))}});const $e={class:"viewer"},ke=k(" Viewer: "),Se=["onClick"],je=x({setup(t){const e=()=>{var a;U(m.name,{viewOnly:!((a=O.value)!=null&&a.viewOnly)})},l=(a,v)=>{var c,p;const f=((c=O.value)==null?void 0:c.estimate)===a,_=v!=null?v:f?!((p=O.value)!=null&&p.ready):!0;U(m.name,{ready:_,estimate:_?a:G()})},n=$("");let s;return document.addEventListener("keydown",a=>{var v;if(!((v=O.value)!=null&&v.viewOnly)){if(["Backspace"].includes(a.key)){clearTimeout(s),n.value="",l(null,!1);return}a.key.length>1||(n.value+=a.key,clearTimeout(s),s=setTimeout(()=>{var f;(f=o.state)!=null&&f.settings.options.includes(n.value)&&l(n.value,!0),n.value=""},500))}}),(a,v)=>{var f,_;return r(),d(y,null,[(r(),I(P,{to:"#globalcontrols"},[u("button",{onClick:e,class:C({active:(f=i(O))==null?void 0:f.viewOnly}),title:"View Mode"},"\u{1F441}",2),w(u("div",$e,[ke,(r(!0),d(y,null,V(i(q),c=>(r(),d("span",{class:C({active:c===i(m).name})},b(c),3))),256))],512),[[N,i(q).length>0]])])),u("div",null,b(n.value),1),(r(!0),d(y,null,V((_=i(o).state)==null?void 0:_.settings.options,c=>{var p,g;return w((r(),d("button",{class:C({active:c===((p=i(O))==null?void 0:p.estimate)}),onClick:F=>l(c)},b(c),11,Se)),[[N,!((g=i(O))!=null&&g.viewOnly)]])}),256))],64)}}});const Ce={key:0,class:"results"},Ne=u("h3",null,"Result:",-1),Ve={class:"entry"},Ae=x({setup(t){const e=h(()=>Object.values(z.value).reduce((n,{estimate:s=""})=>{var a;return n[s]=((a=n[s])!=null?a:0)+1,n},{}));return(l,n)=>i(Y)?(r(),d("div",Ce,[Ne,w(j(Z,{roll:!1,value:Math.max(...Object.keys(i(e)))+"",values:[]},null,8,["value"]),[[N,Object.keys(i(e)).length<=2]]),u("div",null,[(r(!0),d(y,null,V(i(e),(s,a)=>(r(),d("span",Ve,b(s)+"x "+b(a),1))),256))])])):E("",!0)}});const Fe=u("div",{id:"globalcontrols"},null,-1),Me={class:"users"},Ee=x({setup(t){return(e,l)=>(r(),d(y,null,[Fe,j(Oe),j(je),u("div",Me,[(r(!0),d(y,null,V(i(de),n=>(r(),I(pe,{name:n,user:i(z)[n]},null,8,["name","user"]))),256))]),j(Ae)],64))}}),Ue=k(" Enter your name: "),Ie=k(),Te=x({setup(t){const e=$(m.name),l=()=>{m.name=e.value};return(n,s)=>(r(),d(y,null,[Ue,w(u("input",{"onUpdate:modelValue":s[0]||(s[0]=a=>e.value=a)},null,512),[[D,e.value]]),Ie,u("button",{onClick:l},"Go")],64))}});const ze=x({setup(t){const e=h(()=>m.name?o.loading?null:o.active?Ee:_e:Te);return(l,n)=>(r(),I(oe(i(e))))}});ie(ze).mount("#app");
