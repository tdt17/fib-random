import{r as H,w as A,a as O,i as te,d as se,c as h,H as ne,b as L,j as P,z as ae,n as oe,e as k,o as u,f as v,g as b,v as E,u as r,h as c,t as w,F as g,k as V,l as K,m as j,p as C,q as T,T as G,s as D,x as N,y as le,A as $,B as J,C as ie,D as re}from"./vendor.2e9455bf.js";const ue=function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))n(s);new MutationObserver(s=>{for(const a of s)if(a.type==="childList")for(const l of a.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&n(l)}).observe(document,{childList:!0,subtree:!0});function o(s){const a={};return s.integrity&&(a.integrity=s.integrity),s.referrerpolicy&&(a.referrerPolicy=s.referrerpolicy),s.crossorigin==="use-credentials"?a.credentials="include":s.crossorigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function n(s){if(s.ep)return;s.ep=!0;const a=o(s);fetch(s.href,a)}};ue();const Q="fib-config",m=H({name:""});Object.assign(m,JSON.parse(localStorage.getItem(Q)||"{}"));A(m,t=>{localStorage.setItem(Q,JSON.stringify(t))});const S=O(!1);te({apiKey:"AIzaSyDlAUfPJ6T-xQMJcsbAT3SW7zFSFxDQZh4",authDomain:"fib-random.firebaseapp.com",projectId:"fib-random",storageBucket:"fib-random.appspot.com",messagingSenderId:"724579742971",appId:"1:724579742971:web:7b8e2259a4d585b9be6c5e"});const z=se(),ce=async()=>{const t={users:{},settings:{admin:m.name,options:["1","2","3","5","8","13","21"],openSettings:!1}};return(await ae(oe(z,"sessions"),t)).id},i=H({loading:!0,id:window.location.hash.slice(1),active:!1,state:void 0}),B=h(()=>{var t;return Object.fromEntries(Object.entries(((t=i.state)==null?void 0:t.users)||{}).filter(([,{viewOnly:e}])=>!e))}),de=h(()=>{var t;return Object.fromEntries(Object.entries(((t=i.state)==null?void 0:t.users)||{}).filter(([,{viewOnly:e}])=>e))}),ve=h(()=>Object.keys(B.value).sort()),q=h(()=>Object.keys(de.value).sort()),Y=h(()=>Object.values(B.value).every(({ready:t})=>t)),x=h(()=>{var t;return(t=i.state)==null?void 0:t.users[m.name]}),U=h(()=>{var t,e;return((t=i.state)==null?void 0:t.settings.openSettings)||((e=i.state)==null?void 0:e.settings.admin)===m.name});let M;A(()=>[i.id,m.name],([t,e])=>{if(!e||!t){i.loading=!1;return}M==null||M(),M=ne(L(z,`sessions/${t}`),o=>{i.active=o.exists(),i.state=o.data(),i.loading=!1})},{immediate:!0});const I=async(t,e)=>{await P(L(z,`sessions/${i.id}`),{users:{[t]:e}},{merge:!0})},Z=async t=>{await P(L(z,`sessions/${i.id}`),t,{merge:!0})};A(()=>{var t;return[(t=i.state)==null?void 0:t.users,m.name]},([t,e])=>{!t||typeof t=="string"||!e||typeof e!="string"||t[e]||I(e,{ready:!1,estimate:""+~~(Math.random()*100)})});window.addEventListener("hashchange",()=>{i.id=window.location.hash.slice(1)});Object.assign(window,{session:i});const _e=k({setup(t){const e=async()=>{const o=await ce();window.location.hash=o};return(o,n)=>(u(),v(g,null,[b(c("div",null,'Session "'+w(r(i).id)+'" not found',513),[[E,r(i).id]]),c("button",{onClick:e},"New Session")],64))}});const W=k({props:{roll:{type:Boolean},value:null,values:null,scale:{default:.2},speed:{default:1}},setup(t){const e=t,o=h(()=>e.roll?new Array(20).fill("?"):new Array(20).fill(e.value)),n=O([0,0,0]);let s;const a=()=>{const l=setInterval(()=>{const[f,_,d]=n.value,p=e.speed*300,y=[Math.random(),Math.random(),Math.random()],F=y[0]+y[1]+y[2],[X,R,ee]=[p*y[0]/F,p*y[1]/F,p*y[2]/F];n.value=[f+X,_+R,d+ee]},1e3);s=()=>clearInterval(l)};return A(()=>e.roll,l=>{l?a():(s==null||s(),n.value=[231,107,0])},{immediate:!0}),(l,f)=>(u(),v("div",{class:"dice-box",style:K({width:400*e.scale+"px",height:400*e.scale+"px"})},[c("ul",{class:"d20",style:K({transform:`scale3d(${e.scale},${e.scale},${e.scale}) rotateX(${n.value[0]}deg) rotateY(${n.value[1]}deg) rotateZ(${n.value[2]}deg)`,transition:`1s ${e.roll?"linear":"ease-out"}`})},[(u(!0),v(g,null,V(r(o),_=>(u(),v("li",null,w(_),1))),256))],4)],4))}});const me={class:"configs"},pe=k({props:{name:null,user:null},setup(t){const e=t,o=()=>{I(e.name,{viewOnly:!0})};return(n,s)=>(u(),v("div",{class:C(["user",{active:t.name===r(m).name,"view-mode":t.user.viewOnly}])},[b(c("div",me,[c("button",{onClick:o},"\u{1F441}")],512),[[E,r(S)]]),c("h3",null,w(t.name)+" "+w(t.user.ready?"\u2714":"\u25FB\uFE0E"),1),j(W,{roll:!t.user.ready,value:r(Y)?t.user.estimate||"":"?",values:[]},null,8,["roll","value"])],2))}});const fe={key:0,class:"settings"},ye=c("h3",null,"Settings",-1),ge=$("Name: "),he={key:0},be=$("Options: "),we={key:1},ke=$("Settings for all available: "),xe=k({setup(t){var l,f;const e=()=>{S.value=!S.value},o=O((l=i.state)==null?void 0:l.settings.options.join(";"));A(()=>{var _;return(_=i.state)==null?void 0:_.settings.options.join(";")},_=>{o.value=_});const n=O(m.name),s=O((f=i.state)==null?void 0:f.settings.openSettings),a=()=>{var d,p,y;const _={};if(n.value!==m.name){if((d=i.state)!=null&&d.users[n.value]){alert(`Name "${n.value}" is already taken`),n.value=m.name;return}_.users={[m.name]:J()},m.name=n.value}U.value&&(_.settings={options:(y=(p=o.value)==null?void 0:p.split(";"))!=null?y:[],openSettings:s.value}),Z(_)};return(_,d)=>(u(),v(g,null,[(u(),T(G,{to:"#globalcontrols"},[c("button",{class:C({active:r(S)}),onClick:e},"\u2699\uFE0F",2)])),r(S)?(u(),v("div",fe,[ye,c("div",null,[ge,b(c("input",{"onUpdate:modelValue":d[0]||(d[0]=p=>n.value=p)},null,512),[[D,n.value]])]),r(U)?(u(),v("div",he,[be,b(c("input",{"onUpdate:modelValue":d[1]||(d[1]=p=>o.value=p)},null,512),[[D,o.value]])])):N("",!0),r(U)?(u(),v("div",we,[ke,b(c("input",{type:"checkbox","onUpdate:modelValue":d[2]||(d[2]=p=>s.value=p)},null,512),[[le,s.value]])])):N("",!0),c("button",{onClick:a},"save")])):N("",!0)],64))}});const Oe={class:"viewer"},$e=$(" Viewer: "),Se=["onClick"],je=k({setup(t){const e=()=>{var a;I(m.name,{viewOnly:!((a=x.value)!=null&&a.viewOnly)})},o=(a,l)=>{var d,p;const f=((d=x.value)==null?void 0:d.estimate)===a,_=l!=null?l:f?!((p=x.value)!=null&&p.ready):!0;I(m.name,{ready:_,estimate:_?a:J()})},n=O("");let s;return document.addEventListener("keydown",a=>{var l;if(!((l=x.value)!=null&&l.viewOnly)){if(["Backspace"].includes(a.key)){clearTimeout(s),n.value="",o(null,!1);return}a.key.length>1||(n.value+=a.key,clearTimeout(s),s=setTimeout(()=>{var f;(f=i.state)!=null&&f.settings.options.includes(n.value)&&o(n.value,!0),n.value=""},500))}}),(a,l)=>{var f,_;return u(),v(g,null,[(u(),T(G,{to:"#globalcontrols"},[c("button",{onClick:e,class:C({active:(f=r(x))==null?void 0:f.viewOnly}),title:"View Mode"},"\u{1F441}",2),b(c("div",Oe,[$e,(u(!0),v(g,null,V(r(q),d=>(u(),v("span",{class:C({active:d===r(m).name})},w(d),3))),256))],512),[[E,r(q).length>0]])])),c("div",null,w(n.value),1),(u(!0),v(g,null,V((_=r(i).state)==null?void 0:_.settings.options,d=>{var p,y;return b((u(),v("button",{class:C({active:d===((p=r(x))==null?void 0:p.estimate)}),onClick:F=>o(d)},w(d),11,Se)),[[E,!((y=r(x))!=null&&y.viewOnly)]])}),256))],64)}}});const Ce={key:0,class:"results"},Ne=c("h3",null,"Result:",-1),Ee={class:"entry"},Ve=k({setup(t){const e=h(()=>Object.values(B.value).reduce((s,{estimate:a=""})=>{var l;return s[a]=((l=s[a])!=null?l:0)+1,s},{})),o=()=>{var s;const n=Object.fromEntries(Object.keys(((s=i.state)==null?void 0:s.users)||{}).map(a=>[a,{ready:!1,estimate:J()}]));Z({users:n})};return(n,s)=>r(Y)?(u(),v("div",Ce,[Ne,b(j(W,{roll:!1,value:Math.max(...Object.keys(r(e)))+"",values:[]},null,8,["value"]),[[E,Object.keys(r(e)).length<=2]]),c("div",null,[(u(!0),v(g,null,V(r(e),(a,l)=>(u(),v("span",Ee,w(a)+"x "+w(l),1))),256))]),r(U)?(u(),v("button",{key:0,onClick:o},"Next")):N("",!0)])):N("",!0)}});const Ae=c("div",{id:"globalcontrols"},null,-1),Fe={class:"users"},Me=k({setup(t){return(e,o)=>(u(),v(g,null,[Ae,j(xe),j(je),c("div",Fe,[(u(!0),v(g,null,V(r(ve),n=>(u(),T(pe,{name:n,user:r(B)[n]},null,8,["name","user"]))),256))]),j(Ve)],64))}}),Ue=$(" Enter your name: "),Ie=$(),Te=k({setup(t){const e=O(m.name),o=()=>{m.name=e.value},n=s=>{s.key==="Enter"&&o()};return(s,a)=>(u(),v(g,null,[Ue,b(c("input",{"onUpdate:modelValue":a[0]||(a[0]=l=>e.value=l),onKeypress:n},null,544),[[D,e.value]]),Ie,c("button",{onClick:o},"Go")],64))}});const ze=k({setup(t){const e=h(()=>m.name?i.loading?null:i.active?Me:_e:Te);return(o,n)=>(u(),T(ie(r(e))))}});re(ze).mount("#app");
